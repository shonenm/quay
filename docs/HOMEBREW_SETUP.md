# Homebrew Tap Setup Guide

## Overview

Quay uses a custom Homebrew tap for macOS distribution. The tap is automatically updated by cargo-dist when a new release is published.

## Repository Setup

### 1. Create the Tap Repository

Create a new GitHub repository named `homebrew-quay` under your account:

```bash
# Repository name must be: homebrew-quay
# Full URL: https://github.com/shonenm/homebrew-quay
```

### 2. Initialize the Repository

```bash
git clone https://github.com/shonenm/homebrew-quay
cd homebrew-quay
mkdir Formula
touch README.md
git add .
git commit -m "Initial commit"
git push origin main
```

### 3. README.md Template

```markdown
# Homebrew Tap for Quay

A TUI port manager for local processes, SSH forwards, and Docker containers.

## Installation

```bash
brew tap shonenm/quay
brew install quay
```

## Update

```bash
brew update
brew upgrade quay
```
```

## Formula Template

The formula will be auto-generated by cargo-dist. Here's the expected structure:

```ruby
# Formula/quay.rb
class Quay < Formula
  desc "A TUI port manager for local processes, SSH forwards, and Docker containers"
  homepage "https://github.com/shonenm/quay"
  version "0.1.0"

  on_macos do
    if Hardware::CPU.arm?
      url "https://github.com/shonenm/quay/releases/download/v0.1.0/quay-0.1.0-aarch64-apple-darwin.tar.gz"
      sha256 "..."
    else
      url "https://github.com/shonenm/quay/releases/download/v0.1.0/quay-0.1.0-x86_64-apple-darwin.tar.gz"
      sha256 "..."
    end
  end

  def install
    bin.install "quay"
  end

  test do
    assert_match "quay", shell_output("#{bin}/quay --version")
  end
end
```

## Automated Updates

When you create a new release tag (e.g., `v0.2.0`), the release workflow will:

1. Build binaries for all platforms
2. Create a GitHub Release
3. Update the formula in the tap repository with new URLs and checksums

### Required Secrets

For automated tap updates, add a Personal Access Token with repo access:

1. Go to GitHub Settings → Developer settings → Personal access tokens
2. Create a token with `repo` scope
3. Add as `HOMEBREW_TAP_TOKEN` in the main repository's secrets

## Manual Formula Update

If automation fails, update manually:

```bash
cd homebrew-quay

# Download and get sha256
curl -sL https://github.com/shonenm/quay/releases/download/vX.X.X/quay-X.X.X-aarch64-apple-darwin.tar.gz | sha256sum
curl -sL https://github.com/shonenm/quay/releases/download/vX.X.X/quay-X.X.X-x86_64-apple-darwin.tar.gz | sha256sum

# Update Formula/quay.rb with new version and checksums
# Commit and push
git add Formula/quay.rb
git commit -m "quay X.X.X"
git push origin main
```

## User Installation

Once the tap is set up:

```bash
# Add the tap
brew tap shonenm/quay

# Install quay
brew install quay

# Verify
quay --version
```
